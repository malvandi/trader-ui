<div class="table-container ss02">
  <div *ngIf="!data?.entries?.length" class="table-loader">
    <div class="spinner"></div>
    <span>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span>
  </div>

  <table class="activity-table" [class.loading]="!data?.entries?.length">
    <thead>
      <tr>
        <th rowspan="3">Ú©Ø¯</th>
        <th rowspan="3">RSI</th>
        <th [attr.colspan]="((data?.years?.length || 0) + ((data?.years?.length || 0) - 1)) * 3">Ù‚ÛŒÙ…Øª</th>
        <th [attr.colspan]="((data?.years?.length || 0) + ((data?.years?.length || 0) - 1)) * 3">ØªØ¹Ø¯Ø§Ø¯</th>
        <th rowspan="3"></th>
      </tr>
      <tr>
        <th [attr.colspan]="(data?.years?.length || 0) + ((data?.years?.length || 0) - 1)">Ø¯Ø§Ø®Ù„ÛŒ</th>
        <th [attr.colspan]="(data?.years?.length || 0) + ((data?.years?.length || 0) - 1)">ØµØ§Ø¯Ø±Ø§ØªÛŒ</th>
        <th [attr.colspan]="(data?.years?.length || 0) + ((data?.years?.length || 0) - 1)">Ú©Ù„</th>
        <th [attr.colspan]="(data?.years?.length || 0) + ((data?.years?.length || 0) - 1)">Ø¯Ø§Ø®Ù„ÛŒ</th>
        <th [attr.colspan]="(data?.years?.length || 0) + ((data?.years?.length || 0) - 1)">ØµØ§Ø¯Ø±Ø§ØªÛŒ</th>
        <th [attr.colspan]="(data?.years?.length || 0) + ((data?.years?.length || 0) - 1)">Ú©Ù„</th>
      </tr>
      <tr>
        <!-- Price Headers -->
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0" (click)="sort('domesticSellPrice_' + getChangeYear(year))" class="sortable">
            % {{getSortIcon('domesticSellPrice_' + getChangeYear(year))}}
          </th>
        </ng-container>
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0" (click)="sort('exportSellPrice_' + getChangeYear(year))" class="sortable">
            % {{getSortIcon('exportSellPrice_' + getChangeYear(year))}}
          </th>
        </ng-container>
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0" (click)="sort('totalSellPrice_' + getChangeYear(year))" class="sortable">
            % {{getSortIcon('totalSellPrice_' + getChangeYear(year))}}
          </th>
        </ng-container>
        <!-- Count Headers -->
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0" (click)="sort('totalSellCount_' + getChangeYear(year))" class="sortable">
            % {{getSortIcon('totalSellCount_' + getChangeYear(year))}}
          </th>
        </ng-container>
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0" (click)="sort('totalSellCount_' + getChangeYear(year))" class="sortable">
            % {{getSortIcon('totalSellCount_' + getChangeYear(year))}}
          </th>
        </ng-container>
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0" (click)="sort('totalSellCount_' + getChangeYear(year))" class="sortable">
            % {{getSortIcon('totalSellCount_' + getChangeYear(year))}}
          </th>
        </ng-container>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let record of data?.entries || []">
        <td>{{record.code}}</td>
        <td>{{record.rsi}}</td>

        <!-- Price Columns -->
        <!-- Domestic Price -->
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <td [title]="getTooltipText(record.domesticSellPrice[year], true)">{{getValueWithCommas(record.domesticSellPrice[year], true)}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.domesticSellPrice[getChangeYear(year)] > 0"
              [class.change-negative]="record.domesticSellPrice[getChangeYear(year)] < 0">
            {{getPercentage(record.domesticSellPrice[getChangeYear(year)])}}
          </td>
        </ng-container>

        <!-- Export Price -->
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <td [title]="getTooltipText(record.exportSellPrice[year], true)">{{getValueWithCommas(record.exportSellPrice[year], true)}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.exportSellPrice[getChangeYear(year)] > 0"
              [class.change-negative]="record.exportSellPrice[getChangeYear(year)] < 0">
            {{getPercentage(record.exportSellPrice[getChangeYear(year)])}}
          </td>
        </ng-container>

        <!-- Total Price -->
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <td [title]="getTooltipText(record.totalSellPrice[year], true)">{{getValueWithCommas(record.totalSellPrice[year], true)}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.totalSellPrice[getChangeYear(year)] > 0"
              [class.change-negative]="record.totalSellPrice[getChangeYear(year)] < 0">
            {{getPercentage(record.totalSellPrice[getChangeYear(year)])}}
          </td>
        </ng-container>

        <!-- Count Columns -->
        <!-- Domestic Count -->
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <td>{{getValueWithCommas(record.domesticSellCount[year])}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.domesticSellCount[getChangeYear(year)] > 0"
              [class.change-negative]="record.domesticSellCount[getChangeYear(year)] < 0">
            {{getPercentage(record.domesticSellCount[getChangeYear(year)])}}
          </td>
        </ng-container>

        <!-- Export Count -->
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <td>{{getValueWithCommas(record.exportSellCount[year])}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.exportSellCount[getChangeYear(year)] > 0"
              [class.change-negative]="record.exportSellCount[getChangeYear(year)] < 0">
            {{getPercentage(record.exportSellCount[getChangeYear(year)])}}
          </td>
        </ng-container>

        <!-- Total Count -->
        <ng-container *ngFor="let year of data?.years || []; let i = index">
          <td>{{getValueWithCommas(record.totalSellCount[year])}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.totalSellCount[getChangeYear(year)] > 0"
              [class.change-negative]="record.totalSellCount[getChangeYear(year)] < 0">
            {{getPercentage(record.totalSellCount[getChangeYear(year)])}}
          </td>
        </ng-container>

        <td>
          <span class="chart-link" (click)="openChart(record.rahavardId)" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†Ù…ÙˆØ¯Ø§Ø±">ðŸ”—</span>
          <span class="detail-link" (click)="openDetails(record)" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª">ðŸ“‹</span>
        </td>
      </tr>
    </tbody>
  </table>
</div>
