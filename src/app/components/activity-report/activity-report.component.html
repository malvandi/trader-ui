<div class="table-container">
  <table class="activity-table">
    <thead>
      <tr>
        <th rowspan="3">کد</th>
        <th rowspan="3">RSI</th>
        <th rowspan="3">شناسه رهاورد</th>
        <th [attr.colspan]="(data.years.length + (data.years.length - 1)) * 3">قیمت</th>
        <th [attr.colspan]="(data.years.length + (data.years.length - 1)) * 3">تعداد</th>
      </tr>
      <tr>
        <th [attr.colspan]="data.years.length + (data.years.length - 1)">داخلی</th>
        <th [attr.colspan]="data.years.length + (data.years.length - 1)">صادراتی</th>
        <th [attr.colspan]="data.years.length + (data.years.length - 1)">کل</th>
        <th [attr.colspan]="data.years.length + (data.years.length - 1)">داخلی</th>
        <th [attr.colspan]="data.years.length + (data.years.length - 1)">صادراتی</th>
        <th [attr.colspan]="data.years.length + (data.years.length - 1)">کل</th>
      </tr>
      <tr>
        <!-- Price Headers -->
        <ng-container *ngFor="let year of data.years; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0">تغییرات</th>
        </ng-container>
        <ng-container *ngFor="let year of data.years; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0">تغییرات</th>
        </ng-container>
        <ng-container *ngFor="let year of data.years; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0">تغییرات</th>
        </ng-container>
        <!-- Count Headers -->
        <ng-container *ngFor="let year of data.years; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0">تغییرات</th>
        </ng-container>
        <ng-container *ngFor="let year of data.years; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0">تغییرات</th>
        </ng-container>
        <ng-container *ngFor="let year of data.years; let i = index">
          <th>{{year}}</th>
          <th *ngIf="i > 0">تغییرات</th>
        </ng-container>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let record of data.records">
        <td>{{record.code}}</td>
        <td>{{record.rsi}}</td>
        <td>{{record.rahavardId}}</td>
        
        <!-- Price Columns -->
        <!-- Domestic Price -->
        <ng-container *ngFor="let year of data.years; let i = index">
          <td>{{getValueWithCommas(record.domesticSellPrice[year])}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.domesticSellPrice[getChangeYear(year)] > 0"
              [class.change-negative]="record.domesticSellPrice[getChangeYear(year)] < 0">
            {{getPercentage(record.domesticSellPrice[getChangeYear(year)])}}
          </td>
        </ng-container>
        
        <!-- Export Price -->
        <ng-container *ngFor="let year of data.years; let i = index">
          <td>{{getValueWithCommas(record.exportSellPrice[year])}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.exportSellPrice[getChangeYear(year)] > 0"
              [class.change-negative]="record.exportSellPrice[getChangeYear(year)] < 0">
            {{getPercentage(record.exportSellPrice[getChangeYear(year)])}}
          </td>
        </ng-container>
        
        <!-- Total Price -->
        <ng-container *ngFor="let year of data.years; let i = index">
          <td>{{getValueWithCommas(record.totalSellPrice[year])}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.totalSellPrice[getChangeYear(year)] > 0"
              [class.change-negative]="record.totalSellPrice[getChangeYear(year)] < 0">
            {{getPercentage(record.totalSellPrice[getChangeYear(year)])}}
          </td>
        </ng-container>
        
        <!-- Count Columns -->
        <!-- Domestic Count -->
        <ng-container *ngFor="let year of data.years; let i = index">
          <td>{{getValueWithCommas(record.domesticSellCount[year])}}</td>
          <td *ngIf="i > 0" 
              [class.change-positive]="record.domesticSellCount[getChangeYear(year)] > 0"
              [class.change-negative]="record.domesticSellCount[getChangeYear(year)] < 0">
            {{getPercentage(record.domesticSellCount[getChangeYear(year)])}}
          </td>
        </ng-container>
        
        <!-- Export Count -->
        <ng-container *ngFor="let year of data.years; let i = index">
          <td>{{getValueWithCommas(record.exportSellCount[year])}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.exportSellCount[getChangeYear(year)] > 0"
              [class.change-negative]="record.exportSellCount[getChangeYear(year)] < 0">
            {{getPercentage(record.exportSellCount[getChangeYear(year)])}}
          </td>
        </ng-container>
        
        <!-- Total Count -->
        <ng-container *ngFor="let year of data.years; let i = index">
          <td>{{getValueWithCommas(record.totalSellCount[year])}}</td>
          <td *ngIf="i > 0"
              [class.change-positive]="record.totalSellCount[getChangeYear(year)] > 0"
              [class.change-negative]="record.totalSellCount[getChangeYear(year)] < 0">
            {{getPercentage(record.totalSellCount[getChangeYear(year)])}}
          </td>
        </ng-container>
      </tr>
    </tbody>
  </table>
</div>
